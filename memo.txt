
## コンセプト

* 小さく循環させる
* 長いサイクルを生み出す短いサイクル
* 非同期のコミットを家族や友達と

* ぽこぽこわいて来る楽しみなくじ
* 常時選択
* "イベントを集めるゲーム"

* コミュニケーションネタが必要
** 壮大な謎解き or 総当り
** 投票 ... 指示の表明（魔法の矢を点に放つ）
** 選ばれたユーザーによるスペルの生成

## TODO

* NewDoll
* encountイベントの加算

* a d1 # d1をアクティブに
* jab :fig
** => "d1はfitherになりました"
* d1.job :fig

## idea

* フリーの町
** 町の寿命
** 町もボードゲームっぽい初期パラメータ
* コミュニケーションのとれない普遍的な2種族の対立

job

* hpは3
* 戦士のhpボーナスは4
* 隊列pos値により攻撃力算出のマイナス
* 槍はレンジ1

## ライフサイクル

* dollの寿命は町の寿命と共に尽きる
** 限定アイテムで町の寿命を延ばせるが、延命に日数に応じてコストが増大するので実質有限
* dollのライフと町のライフを先読み計算するのがキモ
* 町の寿命とミッション
* ミッションをクリアすると次の町へ進める
* 1stミッションは武力強化 => いったんピークまで
* 2ndミッションは武力安定 => コンスタントにある程度の武力
* 2ndミッションは偶然 => ひたすら期待率を高める
* 3rdミッションは協力 => 人数を増やして役割分担をしないと無理

### アイテムの持ち越し

* dollは町を移動できない
* 袋を使うといくつかのアイテムを持ち越すことができる
** 袋の所有物は半固定（毎回再設定だと忘れそうなので）

### アイテムの寿命

* すべてのアイテムには寿命がある
** 実質的に永久に延命できるがコストがかかる

## CUIクライアント

    doll:107 (8)
    doll:127
    doll:128 (3)

    > open [107, #1]

    event: モンスターと遭遇した！

    > [card]

    モンスターを倒しました
    doll:107はダメージを受けた
    doll:107はダメージを受けた
    doll:107はダメージを受けた

    event: 宝箱を発見した！(---xo+)
    
    
## 簡易GUIクライアント

ブラウザアプリ。
これは単なるビュアー。

## イベント

コンセプトは抽選と選択（カード使用）。

eventは結果だけあればよい。表示は概要=>結果の2段階。
消費期限を過ぎると消滅する。

    モンスター(遭遇) -> HP減少判定
      has_many :monsters
        -> monster        
        -> monster        
   
    V V V
  
    宝箱(トレジャー ) -> 罠解除判定 (-> 罠発動)
      has_many :items
        -> item
        -> item

  def open
    (doll.events.first or return).open
  end


選択 ... カードの使用

* リターンのカード
* スキップ（スルー）のカード
* 幸運

* 遭遇系
 * 勝利 ... 経験値, HP減少
 * 人
 * 宝箱 ... 金、アイテム
 * 採取 ... アイテム

 * 鍛冶 ... アイテム

## カード

eventオープン前に使用可能。

## エンカウント（通常バトル）

* won, escape, lost
* メンバーのHPが1減る（doll毎に判定）
* レベルアップやアイテムの配分は町で（結果に干渉させないため）

## バトル（ボス戦）

コンセプトは暇つぶし。

ひたすら打撃。打撃、打撃、打撃...
HP3000を1ずつ削る。するとなんと次はHPが倍に。

気を付けてればダメージ0。根気があれば勝てる。

ただ真ん中にいるデカイやつをみんなで倒すだけのiOSアプリはどうだろうか？

炭鉱とか錬金の研磨とかも同様に。

## todo

* どういう仕組でrunを呼び出すか
 * オブジェクトに次回の更新時間を記録しておき、過ぎたものを検索する
* 5分で遊んでる感はどう出す？ 
 * dollにアクション回数やイベント回数を蓄積していく
 * or メッセージ、宝箱や成果物を蓄積していく
 * 出撃、遭遇、撃退、発見 ... 脱出
* 手動アクションと放置アクション　
 * 探検は手動アクション <=> 戦闘訓練
 * 錬金 <=> 基礎調合
 * ポーションの作成は手動アクション ... 「ポーションたくさん作っといたよ」
 * 薬草の栽培は放置アクション ... 「明後日には薬草がとれるはず」

## 選ばれる選ばれし者

* free dollは町にやってくる
* 君主の魅力が高いと強いdollが出現しやすい ... 君主は魅力だけ高けりゃそれでいい
* 宝石箱の数だけdollを持てる ... ネックレス、イヤリング、髪飾り、指輪

* FreeDoll
** town_id
** seed ... idで良い。dollのseedにコピーする

ストック
招待のカード

## Dollの状態

* has_many :dolls
* has_one :doll ... follow, 魅力の高い相手程やる気がアップ（疲労がたまりにくい）
* has_one :explore

* doll(follow)

アクションの進捗は別テーブルで。

* explore
** doll_id
** string:area ... "dungeon" town, dungeon, field
** int:lv
** int:seed
** int:depth ... areaでの深度

* スミス
** doll_id
** int:seed
** int:depth ... areaでの深度



### flags

* sleep ... 休息。町で疲労が蓄積していると勝手に寝る。30分ほどで疲労は90%抜けるので叩き起こすこと
* Guard ... ターゲットを守る


## Dollのアクション

Jobとアクションを1対1で関連付ける。

* Explore ... 探検。ダンジョンへ探索してアイテムを探す
 * fig.戦士 ... モンスター退治がメイン
 * mag.魔法使い... 知識の探求。素材集め
 * thi.シーフ ... 宝探し。Treasure Hunt
* alc.Alchemy ... みんなでレシピデザインをやりたいなあ => githubで共有！
* smi.Blacksmith.鍛冶:鍛冶師
* loa.統治:君主 ... ガードがいないと暗殺される

## 遊び方

 jewel user:create

 jewel dolls

 jewel choice DOLL_ID

 jewel mvt TOWN_ID

 jewel mvd DUNGEON_ID

## action

* 退治 ... 町の治安が良くなり町の人口が増える
* 冒険 ... お宝ゲット
* 寄付 ... 聖堂が発展
* 農業 ... 農作物の収穫量アップ
* 畜産 ... 動物を育てる
* 整備 ... 道をつくる

## town

町がレベルアップすると以下のいずれかの要素がパワーアップする。

* INN ... 宿屋レベルは体力の回復力に影響する
* SHOP
* TAVERN
* TEMPLE
* CASTLE
* 鍛冶屋
* 農場
* 牧場
* 交通

* has_many :users
* has_many :shops
* has_many :dungions
* has_many :feilds

